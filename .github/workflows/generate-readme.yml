name: Generate ReadMe Files for Fonts

on:
  push:
    branches:
      - update-020425  # Change this to the desired branch name
  workflow_dispatch:

jobs:
  generate-readme:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the repository
      uses: actions/checkout@v2

    - name: Generate Readme files
      run: |
        # Read fonts.json and loop through each font
        FONT_JSON_PATH="./src/collections/fonts.json"

        # Loop through each font entry in the JSON
        for font in $(grep -oP '\{.*?\}' $FONT_JSON_PATH); do
          # Extract values using grep (without jq)
          FONT_NAME=$(echo "$font" | grep -oP '"FontName": *"\K([^"]+)' )
          FONT_PATH=$(echo "$font" | grep -oP '"FontPath": *"\K([^"]+)' )
          FONT_FAMILY=$(echo "$font" | grep -oP '"FontFamily": *"\K([^"]+)' )
          FONT_WEIGHTS=$(echo "$font" | grep -oP '"FontWeights": *\[(.*?)\]' | sed 's/\[//;s/\]//')
          FONT_TESTER_WEIGHTS=$(echo "$font" | grep -oP '"FontTesterWeights": *\[(.*?)\]' | sed 's/\[//;s/\]//')
          FONT_DESIGNER=$(echo "$font" | grep -oP '"FontDesigner": *"\K([^"]+)' )
          FONT_DESIGNER_URL=$(echo "$font" | grep -oP '"FontDesignerURL": *"\K([^"]+)' )
          FONT_LICENSE=$(echo "$font" | grep -oP '"FontLicense": *"\K([^"]+)' )

          # Create directory if it doesn't exist
          FONT_DIR="./src/public/fonts/$FONT_PATH"
          mkdir -p $FONT_DIR

          # Create the readme.md file
          echo -e "# $FONT_NAME\n\n## Font Family\n\`\`\`\n$FONT_FAMILY\n\`\`\`\n\n## Font Weights\n$FONT_WEIGHTS\n\n## Font Tester Weights\n$FONT_TESTER_WEIGHTS\n\n## Font Designer\n[$FONT_DESIGNER]($FONT_DESIGNER_URL)\n\n## Font License\n$FONT_LICENSE" > "$FONT_DIR/readme.md"

          echo "Generated readme.md for $FONT_NAME"
        done
